var T=Object.defineProperty;var _=(n,e,t)=>e in n?T(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var o=(n,e,t)=>_(n,typeof e!="symbol"?e+"":e,t);import{aP as w,C as i,aI as M,w as m,aQ as P,ap as a,ao as y,an as u}from"./YuA7MKX-N8BBDZOAxa77.js";import"./CE5gmiwDNewmoagCdzUB.js";import"./C4CWNqOKDa2hgIMmL8UW.js";import"./DwwWpmeAjHPbRl1LR2u4.js";import"./GzLNAtZNvVIgBFPR69zY.js";import"./BjAV885S1e2rG_96LI9m.js";import"./xkzv0Qlxnfw76gdmPHyS.js";import"./DRzGo8zsW-bceYzdc799.js";import"./BeiKrpmzr5FDelkeUPJk.js";import"./BaEv58GwEyYUPx6KSmkr.js";import{M as A}from"./xPz_shXGDcOUm4Qkan6g.js";import"./r000o-h8vp740i0EdxY1.js";import"./B8zkdKxyUOEvZfzaRJKS.js";import"./BvVMhB1gVIHTVkmnp9Ll.js";import"./DCY65HotDeJ_7hiau8fc.js";import"./BnLZY3vCHg8G-zMp6QFV.js";import"./D6iVnI44rA0Q9_gX5YDl.js";import"./CPEAmnM_stuxQPE4iUkT.js";import{L as G}from"./85yZmE5PqfcNKC64qTgv.js";import{P as f}from"./BUjYG6qMQjp0KnokeClt.js";import"./b9QDabEUvKe6AI27JKho.js";var k=Object.defineProperty,S=Object.getOwnPropertyDescriptor,s=(n,e,t,h)=>{for(var p=h>1?void 0:h?S(e,t):e,d=n.length-1,l;d>=0;d--)(l=n[d])&&(p=(h?l(e,t,p):l(p))||p);return h&&p&&k(e,t,p),p};class r{constructor(e,t){o(this,"logger",new G("Channel"));o(this,"app");o(this,"id");o(this,"createdAt");o(this,"name");o(this,"icon");o(this,"type");o(this,"recipients");o(this,"lastMessageId");o(this,"guildId");o(this,"parentId");o(this,"ownerId");o(this,"lastPinTimestamp");o(this,"defaultAutoArchiveDuration");o(this,"position");o(this,"permissionOverwrites");o(this,"videoQualityMode");o(this,"bitrate");o(this,"userLimit");o(this,"nsfw");o(this,"rateLimitPerUser");o(this,"topic");o(this,"invites");o(this,"retentionPolicyId");o(this,"messages");o(this,"voiceStates");o(this,"webhooks");o(this,"flags");o(this,"defaultThreadRateLimitPerUser");o(this,"channelIcon");o(this,"typingIds");o(this,"typing",null);o(this,"hasFetchedInitialMessages",!1);switch(this.app=e,this.typingIds=new w,this.id=t.id,this.createdAt=new Date(t.created_at),this.name=t.name,this.icon=t.icon,this.type=t.type,this.recipients=t.recipients,this.lastMessageId=t.last_message_id,this.guildId=t.guild_id,this.parentId=t.parent_id,this.ownerId=t.owner_id,this.lastPinTimestamp=t.last_pin_timestamp,this.defaultAutoArchiveDuration=t.default_auto_archive_duration,this.position=t.position,this.permissionOverwrites=t.permission_overwrites??[],this.videoQualityMode=t.video_quality_mode,this.bitrate=t.bitrate,this.userLimit=t.user_limit,this.nsfw=t.nsfw,this.rateLimitPerUser=t.rate_limit_per_user,this.topic=t.topic,this.invites=t.invites,this.retentionPolicyId=t.retention_policy_id,this.voiceStates=t.voice_states,this.webhooks=t.webhooks,this.flags=t.flags,this.defaultThreadRateLimitPerUser=t.default_thread_rate_limit_per_user,this.messages=new A(e,this.id),t.messages&&this.messages.addAll(t.messages),this.type){case i.GuildText:this.channelIcon="mdiPound";break;case i.GuildVoice:this.channelIcon="mdiVolumeHigh";break;case i.GuildAnnouncement:case i.AnnouncementThread:this.channelIcon="mdiBullhornVariant";break;case i.GuildStore:case i.Transactional:this.channelIcon="mdiStore";break;case i.Encrypted:case i.EncryptedThread:this.channelIcon="mdiLock";break;case i.PublicThread:case i.PrivateThread:this.channelIcon="mdiCommentMultipleOutline";break;case i.GuildStageVoice:this.channelIcon="mdiBroadcast";break;case i.GuildForum:this.channelIcon="mdiForumOutline";break;case i.TicketTracker:this.channelIcon="mdiTicketOutline";break;case i.KanBan:this.channelIcon="mdiDeveloperBoard";break;case i.VoicelessWhiteboard:this.channelIcon="mdiDraw";break;case i.GuildDirectory:this.channelIcon="mdiFolder";break}M(this)}update(e){Object.assign(this,e)}getMessages(e,t,h,p,d,l){return new Promise((I,v)=>{if(t&&this.hasFetchedInitialMessages)return;let g={limit:h||50};p&&(g={...g,before:p}),d&&(g={...g,after:d}),l&&(g={...g,around:l}),t?this.logger.info(`Fetching initial messages for ${this.id}`):this.logger.info(`Fetching messages for ${this.id} before ${p}`),e.rest.get(m.channelMessages(this.id),g).then(c=>{if("code"in c){this.logger.error(c);return}this.messages.addAll(c.filter(b=>!this.messages.has(b.id))),this.hasFetchedInitialMessages=!0,I(c.length)}).catch(c=>{this.logger.error(c),v(c)})})}async sendMessage(e,t){return e instanceof FormData?this.app.rest.postFormData(m.channelMessages(this.id),e,void 0,void 0,t):this.app.rest.post(m.channelMessages(this.id),e)}get isTextChannel(){return this.type===i.GuildText||this.type===i.GuildVoice||this.type===i.GuildStageVoice||this.type===i.GuildForum||this.type===i.GuildAnnouncement||this.type===i.AnnouncementThread||this.type===i.Encrypted||this.type===i.EncryptedThread||this.type===i.PrivateThread||this.type===i.PublicThread||this.type===i.GroupDM||this.type===i.DM}get isGuildTextChannel(){return this.type===i.GuildText||this.type===i.GuildVoice||this.type===i.GuildStageVoice||this.type===i.GuildForum||this.type===i.GuildAnnouncement||this.type===i.AnnouncementThread||this.type===i.Encrypted||this.type===i.EncryptedThread||this.type===i.PrivateThread||this.type===i.PublicThread}get typingUsers(){return Array.from(this.typingIds.keys()).map(e=>this.app.users.get(e)).filter(e=>e&&e.id!==this.app.account.id)}hasPermission(e){return f.getPermission(this.app.account.id,this.guildId?this.app.guilds.get(this.guildId):void 0,this).has(e)}async startTyping(){this.typing&&this.typing>Date.now()||(this.logger.debug("Client user has started typing"),this.typing=Date.now()+1e4,await this.app.rest.post(m.channelTyping(this.id)))}stopTyping(e){(e||this.typing)&&(this.logger.debug("Client user has stopped typing"),this.typing=null)}get guild(){if(this.guildId)return this.app.guilds.get(this.guildId)}get listId(){let e="everyone";const t=[];for(const h of this.permissionOverwrites){const{id:p,allow:d,deny:l}=h;d.toBigInt()&f.FLAGS.VIEW_CHANNEL?t.push(`allow:${p}`):l.toBigInt()&f.FLAGS.VIEW_CHANNEL&&t.push(`deny:${p}`)}return t.length&&(e=P(t.sort().join(",")).toString()),e}get hasUnread(){const{readstates:e}=this.app.readStateStore,t=e.get(this.id);return t?t.lastMessageId!==this.lastMessageId:!1}markAsRead(){const e=this.app.readStateStore.get(this.id);if(e){if(!this.lastMessageId){this.logger.warn(`No last message for channel ${this.id}`);return}this.app.rest.post(m.channelMessage(this.id,this.lastMessageId)+"/ack",{mention_count:e.mentionCount}).then(t=>{this.logger.debug(`Acked ${this.lastMessageId} for channel ${this.id}`,t)}).catch(t=>{this.logger.error(`Failed to ack ${this.lastMessageId} for channel ${this.id}`,t)})}}}s([a],r.prototype,"name",2);s([a],r.prototype,"icon",2);s([a],r.prototype,"recipients",2);s([a],r.prototype,"lastMessageId",2);s([a],r.prototype,"parentId",2);s([a],r.prototype,"lastPinTimestamp",2);s([a],r.prototype,"defaultAutoArchiveDuration",2);s([a],r.prototype,"position",2);s([a],r.prototype,"permissionOverwrites",2);s([a],r.prototype,"videoQualityMode",2);s([a],r.prototype,"bitrate",2);s([a],r.prototype,"userLimit",2);s([a],r.prototype,"nsfw",2);s([a],r.prototype,"rateLimitPerUser",2);s([a],r.prototype,"topic",2);s([a],r.prototype,"invites",2);s([a],r.prototype,"retentionPolicyId",2);s([a],r.prototype,"messages",2);s([a],r.prototype,"voiceStates",2);s([a],r.prototype,"webhooks",2);s([a],r.prototype,"flags",2);s([a],r.prototype,"defaultThreadRateLimitPerUser",2);s([a],r.prototype,"channelIcon",2);s([a],r.prototype,"typingIds",2);s([a],r.prototype,"typing",2);s([y],r.prototype,"update",1);s([y],r.prototype,"getMessages",1);s([y],r.prototype,"sendMessage",1);s([u],r.prototype,"isTextChannel",1);s([u],r.prototype,"isGuildTextChannel",1);s([u],r.prototype,"typingUsers",1);s([y],r.prototype,"startTyping",1);s([y],r.prototype,"stopTyping",1);s([u],r.prototype,"guild",1);s([u],r.prototype,"listId",1);s([u],r.prototype,"hasUnread",1);export{r as C};
