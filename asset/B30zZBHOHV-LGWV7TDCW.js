import{u as P,R as y,ad as T,w as q,j as e}from"./YuA7MKX-N8BBDZOAxa77.js";import{u as U}from"./RLl1-wCGnkUChJqf8G3O.js";import{S as D}from"./CF6FO32TaLC-BNF6DE7O.js";import{W as V,A as W,S as H,F as O,d,L as h,b as m,a as i,c as u,I as g,e as $,f as G,g as K,h as N}from"./ILN8eB9yg5xHXvAXE1mm.js";import{T as o}from"./BTnekbDuzfJChn_J3HiX.js";import{D as z}from"./Cembimp4ZhoYoU9AyuB5.js";import{H as J}from"./CfM8HJMkRj61Lig_-7Gi.js";import{u as M}from"./CyJ5WJXEKPq0b3c1ZbHJ.js";import{u as Q}from"./DMCex30FeWvvThtDj-pY.js";import"./C4CWNqOKDa2hgIMmL8UW.js";import{G as X}from"./aw3wHiZxDYoFCCMsbTym.js";import"./BUjYG6qMQjp0KnokeClt.js";import"./b9QDabEUvKe6AI27JKho.js";import{m as Y}from"./BehbJKW-Ic5ZiA7tfWXx.js";function ue(){const b=M(),_=Q("RegistrationPage"),F=P(),[n,C]=y.useState(!1),[k,w]=y.useState(),x=y.useRef(null),{register:c,handleSubmit:I,setValue:p,formState:{errors:r},setError:t,clearErrors:S}=T();c("date_of_birth",{required:!0,pattern:/^\d{4}-\d{2}-\d{2}$/});const j=()=>{var a;(a=x.current)==null||a.resetCaptcha(),p("captcha_key",void 0)},{handleInstanceChange:R,isCheckingInstance:B}=U(t,S,"instance"),v=I(a=>{if(r.date_of_birth)return;C(!0),w(void 0),p("captcha_key",void 0);const{instance:A,...l}=a;b.rest.post(q.register(),{...l,consent:!0}).then(s=>{if("token"in s){b.setToken(s.token,!0);return}else _.error(s),t("email",{type:"manual",message:"Unknown Error"})}).catch(s=>{var E;if("captcha_key"in s){if(s.captcha_key[0]!=="captcha-required")t("email",{type:"manual",message:`Captcha Error: ${s.captcha_key[0]}`});else if(s.captcha_service!=="hcaptcha")t("email",{type:"manual",message:`Unsupported captcha service: ${s.captcha_service}`});else{w(s.captcha_sitekey),(E=x.current)==null||E.execute();return}j()}else if("message"in s){if(s.errors){const f=Y(s.errors);f?t(f.field,{type:"manual",message:f.error}):t("email",{type:"manual",message:s.message})}else t("email",{type:"manual",message:s.message});j()}else _.error(s),t("email",{type:"manual",message:"Unknown Error"}),j()}).finally(()=>C(!1))}),L=a=>{p("captcha_key",a),v()};return k?e.jsx(J,{captchaRef:x,sitekey:k,onVerify:L}):e.jsx(V,{children:e.jsxs(W,{children:[e.jsxs(e.Fragment,{children:[e.jsx(D,{height:48,width:"auto"}),e.jsx(H,{noBranding:!0,children:"Create an account"})]}),e.jsxs(O,{onSubmit:v,children:[e.jsxs(d,{marginBottom:!0,style:{marginTop:0},children:[e.jsxs(h,{error:!!r.instance,children:[e.jsx(m,{children:"Instance"}),B!=!1&&e.jsx(i,{children:e.jsxs(e.Fragment,{children:[e.jsx(o,{children:"-"}),"Checking"]})}),r.instance&&e.jsx(i,{children:e.jsxs(e.Fragment,{children:[e.jsx(o,{children:"-"}),r.instance.message]})})]}),e.jsx(u,{children:e.jsx(g,{type:"url",...c("instance",{required:!0,value:X.routeSettings.wellknown}),placeholder:"Instance Root URL",onChange:R,error:!!r.instance,disabled:n})})]}),e.jsxs(d,{marginBottom:!0,style:{marginTop:0},children:[e.jsxs(h,{error:!!r.email,children:[e.jsx(m,{children:"Email"}),r.email&&e.jsx(i,{children:e.jsxs(e.Fragment,{children:[e.jsx(o,{children:"-"}),r.email.message]})})]}),e.jsx(u,{children:e.jsx(g,{type:"email",placeholder:"Email",autoFocus:!0,...c("email",{required:!0}),error:!!r.email,disabled:n})})]}),e.jsxs(d,{marginBottom:!0,style:{marginTop:0},children:[e.jsxs(h,{error:!!r.username,children:[e.jsx(m,{children:"Username"}),r.username&&e.jsx(i,{children:e.jsxs(e.Fragment,{children:[e.jsx(o,{children:"-"}),r.username.message]})})]}),e.jsx(u,{children:e.jsx(g,{...c("username",{required:!0}),placeholder:"Username",error:!!r.username,disabled:n})})]}),e.jsxs(d,{marginBottom:!0,children:[e.jsxs(h,{error:!!r.password,children:[e.jsx(m,{children:"Password"}),r.password&&e.jsx(i,{children:e.jsxs(e.Fragment,{children:[e.jsx(o,{children:"-"}),r.password.message]})})]}),e.jsx(u,{children:e.jsx(g,{type:"password",placeholder:"Password",...c("password",{required:!0}),error:!!r.password,disabled:n})})]}),e.jsxs(d,{marginBottom:!0,children:[e.jsxs(h,{error:!!r.date_of_birth,children:[e.jsx(m,{children:"Date of Birth"}),r.date_of_birth&&e.jsx(i,{children:e.jsxs(e.Fragment,{children:[e.jsx(o,{children:"-"}),r.date_of_birth.message]})})]}),e.jsx(u,{children:e.jsx(z,{onChange:a=>p("date_of_birth",a),onErrorChange:a=>{Object.values(a).some(l=>l)?t("date_of_birth",{type:"manual",message:Object.values(a).filter(l=>l)[0]}):S("date_of_birth")},error:!!r.date_of_birth,disabled:n})})]}),e.jsx($,{palette:"primary",type:"submit",disabled:n,children:"Create Account"}),e.jsxs(G,{children:[e.jsx(K,{children:"Already have an account?Â "}),e.jsx(N,{onClick:()=>{F("/login")},type:"button",children:"Login"})]})]})]})})}export{ue as R};
