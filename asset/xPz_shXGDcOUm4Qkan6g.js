var l=Object.defineProperty;var c=(a,e,s)=>e in a?l(a,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[e]=s;var n=(a,e,s)=>c(a,typeof e!="symbol"?e+"":e,s);import{u as f}from"./DMCex30FeWvvThtDj-pY.js";import{ap as u,aI as v,a2 as y,ao as g,an as d}from"./YuA7MKX-N8BBDZOAxa77.js";import"./tsAyRgMDs-NXJHrTB2J5.js";import"./4WJcBSnOYxEuqdfQOfpK.js";import"./DySALqpNdPh9Jna_Spl3.js";import{M as h}from"./BecsZEBqk_fnN_DlRHyD.js";import"./xBFF9j8HBxXOELsgf_Mw.js";import"./BAn4QhXx0eqK_0X5ekrZ.js";import"./Dmoj_W4VxmUkboS2v2aV.js";import"./D9XdRzw2tkI_TCjguAEr.js";import"./Y8-bfeL-ADaHJ2-vaWDg.js";import"./DEbnp1YMhIs7EiVOe-fW.js";var M=Object.defineProperty,T=Object.getOwnPropertyDescriptor,p=(a,e,s,r)=>{for(var t=r>1?void 0:r?T(e,s):e,o=a.length-1,i;o>=0;o--)(i=a[o])&&(t=(r?i(e,s,t):i(t))||t);return r&&t&&M(e,s,t),t};class m{constructor(e,s){n(this,"app");n(this,"channelId");n(this,"logger");n(this,"messages");this.app=e,this.channelId=s,this.logger=f("MessageStore.ts"),this.messages=u.array([]),v(this)}add(e){this.messages.push(new h(this.app,e))}addAll(e){e.forEach(s=>this.add(s))}get(e){return this.messages.find(s=>s.id===e)}has(e){return this.messages.some(s=>s.id===e)}remove(e){const s=this.get(e);s&&this.messages.remove(s)}update(e){const s=this.get(e.id);if(!s)return;const r=new h(this.app,e);this.messages[this.messages.indexOf(s)]=r}get count(){return this.messages.length}get groups(){return[...this.messages,...Array.from(this.app.queue.messages.values()).filter(r=>r.channel_id===this.channelId)].slice().sort((r,t)=>t.timestamp.getTime()-r.timestamp.getTime()).slice().sort((r,t)=>r.timestamp.getTime()-t.timestamp.getTime()).reduce((r,t)=>{const o=r[r.length-1],i=o==null?void 0:o.messages[o.messages.length-1];return i&&i.author.id===t.author.id&&i.type===t.type&&t.type===y.Default&&t.timestamp.getTime()-i.timestamp.getTime()<=600*1e3?o.messages.unshift(t):r.push({author:t.author,messages:[t]}),r},[]).reverse()}}p([u],m.prototype,"messages",2);p([g],m.prototype,"add",1);p([g],m.prototype,"addAll",1);p([g],m.prototype,"remove",1);p([g],m.prototype,"update",1);p([d],m.prototype,"count",1);p([d],m.prototype,"groups",1);export{m as M};
