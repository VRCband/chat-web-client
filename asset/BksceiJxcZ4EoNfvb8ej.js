import{R as r,q as f,o as M,a3 as b,j as t,a4 as y,a5 as j}from"./YuA7MKX-N8BBDZOAxa77.js";import{H as A}from"./BTnekbDuzfJChn_J3HiX.js";import{u as C}from"./CyJ5WJXEKPq0b3c1ZbHJ.js";import{u as E}from"./DMCex30FeWvvThtDj-pY.js";import{P as S}from"./BUjYG6qMQjp0KnokeClt.js";import"./b9QDabEUvKe6AI27JKho.js";import{M as w}from"./B5_dQ1Ipn6IvxXr3wOm7.js";const G=r.createContext(0),L=82,R=f.div`
	flex: 1 1 auto;
	overflow-y: auto;
	display: flex;
	flex-direction: column-reverse;
`,P=f.div`
	margin: 16px 16px 0 16px;
`;function D({guild:n,channel:e}){const l=C(),a=E("MessageList.tsx"),[d,c]=r.useState(!0),[p,m]=r.useState(!1),o=e.messages.groups,u=r.useRef(null),{width:h}=b({ref:u});r.useEffect(()=>{const i=S.getPermission(l.account.id,n,e).has("READ_MESSAGE_HISTORY");if(m(i),!i){a.debug("User cannot view this channel. Aborting initial message fetch.");return}return n&&e&&e.messages.count===0&&e.getMessages(l,!0).then(g=>{g<50&&c(!1)}),()=>{a.debug("MessageList unmounted"),c(!0),m(!1)}},[n,e]);const x=r.useCallback(()=>{if(!e.messages.count){a.warn("channel has no messages, aborting!");return}const s=o[o.length-1];if(!s){a.warn("No last group found, aborting fetchMore");return}if("status"in s.messages[0])return;const i=s.messages[0].id;a.debug(`Fetching 50 messages before ${i} for channel ${e.id}`),e.getMessages(l,!1,50,i).then(g=>{g<50&&c(!1)})},[e,o]),v=r.useCallback(s=>t.jsx(w,{group:s},`messageGroup-${s.messages[s.messages.length-1].id}`),[o]);return t.jsx(G.Provider,{value:(h??0)-L,children:t.jsx(R,{id:"scrollable-div",ref:u,children:p?t.jsx(y,{dataLength:o.length,next:x,style:{display:"flex",flexDirection:"column-reverse",marginBottom:30,overflow:"hidden"},hasMore:d,inverse:!0,loader:t.jsx(j,{style:{display:"flex",justifyContent:"center",alignContent:"center",margin:30},color:"var(--primary)"}),scrollThreshold:.5,scrollableTarget:"scrollable-div",endMessage:t.jsxs(P,{children:[t.jsxs("h1",{style:{fontWeight:700,margin:"8px 0"},children:["Welcome to #",e.name,"!"]}),t.jsxs("p",{style:{color:"var(--text-secondary)"},children:["This is the start of the #",e.name," channel."]}),t.jsx(A,{})]}),children:o.map(s=>v(s))}):t.jsx("div",{style:{marginBottom:30,paddingLeft:20,color:"var(--text-secondary)"},children:"You do not have permission to read the history of this channel."})})})}const q=M(D);export{q as M,G as a};
