var E=Object.defineProperty;var D=(m,t,s)=>t in m?E(m,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):m[t]=s;var p=(m,t,s)=>D(m,typeof t!="symbol"?t+"":t,s);import{aI as O,aN as c,ap as g,ao as P}from"./DeTGZYeDNQQzD2Hg2g8t.js";import{L as v}from"./85yZmE5PqfcNKC64qTgv.js";import"./D95vS4HXwexk6O9L7iKW.js";import"./b9QDabEUvKe6AI27JKho.js";var U=Object.defineProperty,T=Object.getOwnPropertyDescriptor,l=(m,t,s,i)=>{for(var r=i>1?void 0:i?T(t,s):t,u=m.length-1,a;u>=0;u--)(a=m[u])&&(r=(i?a(t,s,r):a(r))||r);return i&&r&&U(t,s,r),r};class d{constructor(t,s,i){p(this,"logger",new v("GuildMemberListStore"));p(this,"app");p(this,"id");p(this,"guild");p(this,"groups",[]);p(this,"member_count");p(this,"online_count");p(this,"list",[]);this.app=t,this.guild=s;const{groups:r,id:u,member_count:a,online_count:h,ops:o}=i;this.id=u,this.groups=r,this.member_count=a,this.online_count=h,this.computeListData(i.ops),O(this)}update(t){const{groups:s,id:i,member_count:r,online_count:u,ops:a}=t;this.id=i,this.groups=s,this.member_count=r,this.online_count=u,this.computeListData(t.ops)}computeListData(t){for(const s of t){const{op:i,items:r,range:u,item:a,index:h}=s;switch(i){case c.SYNC:{let o=[];for(const e of r)if("group"in e){const n=this.app.roles.get(e.group.id);o.push({title:`${((n==null?void 0:n.name)??e.group.id).toUpperCase()}`,data:[]})}else{this.app.presences.add({...e.member.presence,guild_id:this.guild.id});const n=this.guild.members.get(e.member.id);if(n)o[o.length-1].data.push({member:n,index:e.member.index});else{const b=this.guild.members.add(e.member);o[o.length-1].data.push({member:b,index:e.member.index})}}o=o.filter(e=>e.data.length>0),o=o.map(e=>({...e,title:`${e.title} - ${e.data.length}`})),o=o.filter(e=>!(e.title.toLowerCase().startsWith("offline")&&e.data.length>=100)),this.list=o.map(e=>({name:e.title,items:e.data.sort((n,b)=>{var L,w;const f=(L=n.member.user)==null?void 0:L.username,_=(w=b.member.user)==null?void 0:w.username;return f&&_?f.toLowerCase()>_.toLowerCase()?1:-1:0}).map(n=>n.member)}));break}case c.DELETE:{this.logger.warn("Unimplemented OP DELETE",a),this.logger.debug("DELETE",a);break}case c.UPDATE:{this.logger.warn("Unimplemented OP UPDATE",a);break}case c.INSERT:{this.logger.warn("Unimplemented OP INSERT",a);break}default:{this.logger.warn(`Uknown OP: ${i}`);break}}}}}l([g],d.prototype,"groups",2);l([g],d.prototype,"member_count",2);l([g],d.prototype,"online_count",2);l([g],d.prototype,"list",2);l([P],d.prototype,"update",1);export{d as G};
